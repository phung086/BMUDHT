{"ast":null,"code":"import React,{useEffect,useMemo,useState}from\"react\";import AdminLogin from\"./AdminLogin\";import AdminDashboard from\"./AdminDashboard\";import api from\"../services/api\";import LoaderOverlay from\"./LoaderOverlay\";import{jsx as _jsx,jsxs as _jsxs}from\"react/jsx-runtime\";const AdminApp=()=>{const[accessToken,setAccessToken]=useState(null);const[loading,setLoading]=useState(true);const[error,setError]=useState(null);useEffect(()=>{let mounted=true;(async()=>{try{var _res$data;const token=localStorage.getItem(\"token\");if(!token){setAccessToken(null);setError(null);return;}const res=await api.get(\"/api/auth/me\");const user=(_res$data=res.data)===null||_res$data===void 0?void 0:_res$data.user;if(!mounted)return;if(!user||user.role!==\"admin\"){setAccessToken(null);setError(\"Bạn không có quyền truy cập khu vực quản trị.\");}else{setAccessToken(token);setError(null);}}catch(err){var _err$response,_err$response$data;if(!mounted)return;setAccessToken(null);setError(((_err$response=err.response)===null||_err$response===void 0?void 0:(_err$response$data=_err$response.data)===null||_err$response$data===void 0?void 0:_err$response$data.error)||\"Không thể xác thực quyền quản trị.\");}finally{if(mounted)setLoading(false);}})();return()=>{mounted=false;};},[]);const handleLoginSuccess=(newAccessToken,refreshToken)=>{localStorage.setItem(\"token\",newAccessToken);setAccessToken(newAccessToken);setError(null);if(refreshToken){try{localStorage.setItem(\"refreshToken\",refreshToken);}catch(e){/* ignore quota errors */}}};const handleLogout=()=>{localStorage.removeItem(\"token\");localStorage.removeItem(\"refreshToken\");setAccessToken(null);setError(null);};const state=useMemo(()=>({accessToken,loading,error}),[accessToken,loading,error]);if(state.loading){return/*#__PURE__*/_jsx(LoaderOverlay,{message:\"\\u0110ang x\\xE1c th\\u1EF1c quy\\u1EC1n qu\\u1EA3n tr\\u1ECB...\"});}if(!state.accessToken){return/*#__PURE__*/_jsxs(\"div\",{className:\"admin-app\",children:[state.error&&/*#__PURE__*/_jsx(\"div\",{className:\"alert alert-warning\",role:\"alert\",children:state.error}),/*#__PURE__*/_jsx(AdminLogin,{onLoginSuccess:handleLoginSuccess})]});}return/*#__PURE__*/_jsx(\"div\",{className:\"admin-app\",children:/*#__PURE__*/_jsx(AdminDashboard,{onLogout:handleLogout})});};export default AdminApp;","map":{"version":3,"names":["React","useEffect","useMemo","useState","AdminLogin","AdminDashboard","api","LoaderOverlay","jsx","_jsx","jsxs","_jsxs","AdminApp","accessToken","setAccessToken","loading","setLoading","error","setError","mounted","_res$data","token","localStorage","getItem","res","get","user","data","role","err","_err$response","_err$response$data","response","handleLoginSuccess","newAccessToken","refreshToken","setItem","e","handleLogout","removeItem","state","message","className","children","onLoginSuccess","onLogout"],"sources":["D:/BMUDHT/frontend/src/components/AdminApp.js"],"sourcesContent":["import React, { useEffect, useMemo, useState } from \"react\";\r\nimport AdminLogin from \"./AdminLogin\";\r\nimport AdminDashboard from \"./AdminDashboard\";\r\nimport api from \"../services/api\";\r\nimport LoaderOverlay from \"./LoaderOverlay\";\r\n\r\nconst AdminApp = () => {\r\n  const [accessToken, setAccessToken] = useState(null);\r\n  const [loading, setLoading] = useState(true);\r\n  const [error, setError] = useState(null);\r\n\r\n  useEffect(() => {\r\n    let mounted = true;\r\n    (async () => {\r\n      try {\r\n        const token = localStorage.getItem(\"token\");\r\n        if (!token) {\r\n          setAccessToken(null);\r\n          setError(null);\r\n          return;\r\n        }\r\n        const res = await api.get(\"/api/auth/me\");\r\n        const user = res.data?.user;\r\n        if (!mounted) return;\r\n        if (!user || user.role !== \"admin\") {\r\n          setAccessToken(null);\r\n          setError(\"Bạn không có quyền truy cập khu vực quản trị.\");\r\n        } else {\r\n          setAccessToken(token);\r\n          setError(null);\r\n        }\r\n      } catch (err) {\r\n        if (!mounted) return;\r\n        setAccessToken(null);\r\n        setError(\r\n          err.response?.data?.error || \"Không thể xác thực quyền quản trị.\"\r\n        );\r\n      } finally {\r\n        if (mounted) setLoading(false);\r\n      }\r\n    })();\r\n    return () => {\r\n      mounted = false;\r\n    };\r\n  }, []);\r\n\r\n  const handleLoginSuccess = (newAccessToken, refreshToken) => {\r\n    localStorage.setItem(\"token\", newAccessToken);\r\n    setAccessToken(newAccessToken);\r\n    setError(null);\r\n    if (refreshToken) {\r\n      try {\r\n        localStorage.setItem(\"refreshToken\", refreshToken);\r\n      } catch (e) {\r\n        /* ignore quota errors */\r\n      }\r\n    }\r\n  };\r\n\r\n  const handleLogout = () => {\r\n    localStorage.removeItem(\"token\");\r\n    localStorage.removeItem(\"refreshToken\");\r\n    setAccessToken(null);\r\n    setError(null);\r\n  };\r\n\r\n  const state = useMemo(\r\n    () => ({ accessToken, loading, error }),\r\n    [accessToken, loading, error]\r\n  );\r\n\r\n  if (state.loading) {\r\n    return <LoaderOverlay message=\"Đang xác thực quyền quản trị...\" />;\r\n  }\r\n\r\n  if (!state.accessToken) {\r\n    return (\r\n      <div className=\"admin-app\">\r\n        {state.error && (\r\n          <div className=\"alert alert-warning\" role=\"alert\">\r\n            {state.error}\r\n          </div>\r\n        )}\r\n        <AdminLogin onLoginSuccess={handleLoginSuccess} />\r\n      </div>\r\n    );\r\n  }\r\n\r\n  return (\r\n    <div className=\"admin-app\">\r\n      <AdminDashboard onLogout={handleLogout} />\r\n    </div>\r\n  );\r\n};\r\n\r\nexport default AdminApp;\r\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}