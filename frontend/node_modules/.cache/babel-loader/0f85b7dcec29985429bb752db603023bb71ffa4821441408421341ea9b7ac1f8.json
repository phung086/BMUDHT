{"ast":null,"code":"import _objectSpread from\"D:/BMUDHT/frontend/node_modules/@babel/runtime/helpers/esm/objectSpread2.js\";import React,{useState,useEffect}from\"react\";import api from\"../services/api\";import{jsx as _jsx,jsxs as _jsxs}from\"react/jsx-runtime\";const UserProfile=()=>{const[user,setUser]=useState(null);const[loading,setLoading]=useState(true);const[error,setError]=useState(null);const[username,setUsername]=useState(\"\");const[email,setEmail]=useState(\"\");const[msg,setMsg]=useState(null);const[pwCurrent,setPwCurrent]=useState(\"\");const[pwNew,setPwNew]=useState(\"\");useEffect(()=>{let mounted=true;const fetchProfile=async()=>{try{const res=await api.get(\"/api/auth/me\");if(!mounted)return;const u=res.data.user;setUser(u);setUsername(u.username||\"\");setEmail(u.email||\"\");}catch(err){var _err$response,_err$response$data;setError(((_err$response=err.response)===null||_err$response===void 0?void 0:(_err$response$data=_err$response.data)===null||_err$response$data===void 0?void 0:_err$response$data.error)||\"Không thể lấy thông tin người dùng\");}finally{setLoading(false);}};fetchProfile();return()=>mounted=false;},[]);const saveProfile=async()=>{setMsg(null);try{const res=await api.put(\"/api/auth/me\",{username,email});setMsg(res.data.message||\"Đã cập nhật\");setUser(s=>_objectSpread(_objectSpread({},s),{},{username,email}));}catch(err){var _err$response2,_err$response2$data;setMsg(((_err$response2=err.response)===null||_err$response2===void 0?void 0:(_err$response2$data=_err$response2.data)===null||_err$response2$data===void 0?void 0:_err$response2$data.error)||\"Cập nhật thất bại\");}};const changePassword=async()=>{setMsg(null);try{const res=await api.post(\"/api/auth/change-password\",{currentPassword:pwCurrent,newPassword:pwNew});setMsg(res.data.message||\"Mật khẩu đã thay đổi\");setPwCurrent(\"\");setPwNew(\"\");}catch(err){var _err$response3,_err$response3$data;setMsg(((_err$response3=err.response)===null||_err$response3===void 0?void 0:(_err$response3$data=_err$response3.data)===null||_err$response3$data===void 0?void 0:_err$response3$data.error)||\"Thay đổi mật khẩu thất bại\");}};if(loading)return/*#__PURE__*/_jsx(\"div\",{className:\"card p-3\",children:\"\\u0110ang t\\u1EA3i...\"});if(error)return/*#__PURE__*/_jsx(\"div\",{className:\"alert alert-danger\",children:error});return/*#__PURE__*/_jsxs(\"div\",{className:\"card p-3\",children:[/*#__PURE__*/_jsx(\"h3\",{children:\"H\\u1ED3 s\\u01A1 ng\\u01B0\\u1EDDi d\\xF9ng\"}),msg&&/*#__PURE__*/_jsx(\"div\",{className:\"alert alert-info\",children:msg}),/*#__PURE__*/_jsxs(\"div\",{className:\"mb-2\",children:[/*#__PURE__*/_jsx(\"label\",{className:\"form-label\",children:\"ID\"}),/*#__PURE__*/_jsx(\"div\",{children:user.id})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"mb-2\",children:[/*#__PURE__*/_jsx(\"label\",{className:\"form-label\",children:\"T\\xEAn ng\\u01B0\\u1EDDi d\\xF9ng\"}),/*#__PURE__*/_jsx(\"input\",{className:\"form-control\",value:username,onChange:e=>setUsername(e.target.value)})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"mb-2\",children:[/*#__PURE__*/_jsx(\"label\",{className:\"form-label\",children:\"Email\"}),/*#__PURE__*/_jsx(\"input\",{className:\"form-control\",value:email,onChange:e=>setEmail(e.target.value)})]}),/*#__PURE__*/_jsx(\"div\",{className:\"mb-3\",children:/*#__PURE__*/_jsx(\"button\",{className:\"btn btn-primary me-2\",onClick:saveProfile,children:\"L\\u01B0u thay \\u0111\\u1ED5i\"})}),/*#__PURE__*/_jsx(\"hr\",{}),/*#__PURE__*/_jsx(\"h5\",{children:\"\\u0110\\u1ED5i m\\u1EADt kh\\u1EA9u\"}),/*#__PURE__*/_jsxs(\"div\",{className:\"mb-2\",children:[/*#__PURE__*/_jsx(\"label\",{className:\"form-label\",children:\"M\\u1EADt kh\\u1EA9u hi\\u1EC7n t\\u1EA1i\"}),/*#__PURE__*/_jsx(\"input\",{type:\"password\",className:\"form-control\",value:pwCurrent,onChange:e=>setPwCurrent(e.target.value)})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"mb-2\",children:[/*#__PURE__*/_jsx(\"label\",{className:\"form-label\",children:\"M\\u1EADt kh\\u1EA9u m\\u1EDBi\"}),/*#__PURE__*/_jsx(\"input\",{type:\"password\",className:\"form-control\",value:pwNew,onChange:e=>setPwNew(e.target.value)})]}),/*#__PURE__*/_jsx(\"div\",{children:/*#__PURE__*/_jsx(\"button\",{className:\"btn btn-warning\",onClick:changePassword,children:\"Thay \\u0111\\u1ED5i m\\u1EADt kh\\u1EA9u\"})})]});};export default UserProfile;","map":{"version":3,"names":["React","useState","useEffect","api","jsx","_jsx","jsxs","_jsxs","UserProfile","user","setUser","loading","setLoading","error","setError","username","setUsername","email","setEmail","msg","setMsg","pwCurrent","setPwCurrent","pwNew","setPwNew","mounted","fetchProfile","res","get","u","data","err","_err$response","_err$response$data","response","saveProfile","put","message","s","_objectSpread","_err$response2","_err$response2$data","changePassword","post","currentPassword","newPassword","_err$response3","_err$response3$data","className","children","id","value","onChange","e","target","onClick","type"],"sources":["D:/BMUDHT/frontend/src/components/UserProfile.js"],"sourcesContent":["import React, { useState, useEffect } from \"react\";\r\nimport api from \"../services/api\";\r\n\r\nconst UserProfile = () => {\r\n  const [user, setUser] = useState(null);\r\n  const [loading, setLoading] = useState(true);\r\n  const [error, setError] = useState(null);\r\n  const [username, setUsername] = useState(\"\");\r\n  const [email, setEmail] = useState(\"\");\r\n  const [msg, setMsg] = useState(null);\r\n  const [pwCurrent, setPwCurrent] = useState(\"\");\r\n  const [pwNew, setPwNew] = useState(\"\");\r\n\r\n  useEffect(() => {\r\n    let mounted = true;\r\n    const fetchProfile = async () => {\r\n      try {\r\n        const res = await api.get(\"/api/auth/me\");\r\n        if (!mounted) return;\r\n        const u = res.data.user;\r\n        setUser(u);\r\n        setUsername(u.username || \"\");\r\n        setEmail(u.email || \"\");\r\n      } catch (err) {\r\n        setError(err.response?.data?.error || \"Không thể lấy thông tin người dùng\");\r\n      } finally {\r\n        setLoading(false);\r\n      }\r\n    };\r\n    fetchProfile();\r\n    return () => (mounted = false);\r\n  }, []);\r\n\r\n  const saveProfile = async () => {\r\n    setMsg(null);\r\n    try {\r\n      const res = await api.put(\"/api/auth/me\", { username, email });\r\n      setMsg(res.data.message || \"Đã cập nhật\");\r\n      setUser((s) => ({ ...s, username, email }));\r\n    } catch (err) {\r\n      setMsg(err.response?.data?.error || \"Cập nhật thất bại\");\r\n    }\r\n  };\r\n\r\n  const changePassword = async () => {\r\n    setMsg(null);\r\n    try {\r\n      const res = await api.post(\"/api/auth/change-password\", {\r\n        currentPassword: pwCurrent,\r\n        newPassword: pwNew,\r\n      });\r\n      setMsg(res.data.message || \"Mật khẩu đã thay đổi\");\r\n      setPwCurrent(\"\");\r\n      setPwNew(\"\");\r\n    } catch (err) {\r\n      setMsg(err.response?.data?.error || \"Thay đổi mật khẩu thất bại\");\r\n    }\r\n  };\r\n\r\n  if (loading) return <div className=\"card p-3\">Đang tải...</div>;\r\n  if (error) return <div className=\"alert alert-danger\">{error}</div>;\r\n\r\n  return (\r\n    <div className=\"card p-3\">\r\n      <h3>Hồ sơ người dùng</h3>\r\n      {msg && <div className=\"alert alert-info\">{msg}</div>}\r\n\r\n      <div className=\"mb-2\">\r\n        <label className=\"form-label\">ID</label>\r\n        <div>{user.id}</div>\r\n      </div>\r\n\r\n      <div className=\"mb-2\">\r\n        <label className=\"form-label\">Tên người dùng</label>\r\n        <input className=\"form-control\" value={username} onChange={(e) => setUsername(e.target.value)} />\r\n      </div>\r\n\r\n      <div className=\"mb-2\">\r\n        <label className=\"form-label\">Email</label>\r\n        <input className=\"form-control\" value={email} onChange={(e) => setEmail(e.target.value)} />\r\n      </div>\r\n\r\n      <div className=\"mb-3\">\r\n        <button className=\"btn btn-primary me-2\" onClick={saveProfile}>Lưu thay đổi</button>\r\n      </div>\r\n\r\n      <hr />\r\n\r\n      <h5>Đổi mật khẩu</h5>\r\n      <div className=\"mb-2\">\r\n        <label className=\"form-label\">Mật khẩu hiện tại</label>\r\n        <input type=\"password\" className=\"form-control\" value={pwCurrent} onChange={(e) => setPwCurrent(e.target.value)} />\r\n      </div>\r\n      <div className=\"mb-2\">\r\n        <label className=\"form-label\">Mật khẩu mới</label>\r\n        <input type=\"password\" className=\"form-control\" value={pwNew} onChange={(e) => setPwNew(e.target.value)} />\r\n      </div>\r\n      <div>\r\n        <button className=\"btn btn-warning\" onClick={changePassword}>Thay đổi mật khẩu</button>\r\n      </div>\r\n    </div>\r\n  );\r\n};\r\n\r\nexport default UserProfile;\r\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}