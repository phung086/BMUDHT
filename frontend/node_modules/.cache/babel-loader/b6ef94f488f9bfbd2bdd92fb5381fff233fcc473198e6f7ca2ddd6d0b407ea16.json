{"ast":null,"code":"var _jsxFileName = \"D:\\\\BMUDHT\\\\frontend\\\\src\\\\context\\\\NotificationContext.js\",\n  _s = $RefreshSig$();\nimport React, { createContext, useCallback, useEffect, useMemo, useState } from \"react\";\nimport api from \"../services/api\";\nimport { getReferenceCode } from \"../utils/reference\";\nimport { jsxDEV as _jsxDEV } from \"react/jsx-dev-runtime\";\nconst NotificationContext = /*#__PURE__*/createContext({\n  notifications: [],\n  unreadCount: 0,\n  refresh: () => Promise.resolve(),\n  markAllAsRead: () => {},\n  markAsRead: () => {}\n});\nconst STORAGE_KEY = \"notification.read\";\nconst loadReadState = () => {\n  try {\n    const raw = localStorage.getItem(STORAGE_KEY);\n    if (!raw) return {};\n    return JSON.parse(raw);\n  } catch (e) {\n    return {};\n  }\n};\nconst saveReadState = map => {\n  try {\n    localStorage.setItem(STORAGE_KEY, JSON.stringify(map));\n  } catch (e) {}\n};\nconst buildNotificationFromTransaction = tx => {\n  const verb = tx.type === \"deposit\" ? \"Nạp\" : tx.type === \"transfer\" ? \"Chuyển\" : \"Giao dịch\";\n  const actor = tx.type === \"deposit\" ? \"vào tài khoản\" : tx.type === \"transfer\" ? `đến ${tx.toUsername}` : tx.description || \"\";\n  const title = tx.type === \"deposit\" ? \"Nạp tiền thành công\" : tx.type === \"transfer\" ? \"Chuyển khoản thành công\" : \"Giao dịch\";\n  const direction = tx.type === \"deposit\" ? 1 : -1;\n  return {\n    id: String(tx.id),\n    title,\n    description: tx.description || `${verb} ${actor}`.trim(),\n    amount: direction * Number(tx.amount || 0),\n    status: tx.status,\n    createdAt: tx.createdAt,\n    reference: getReferenceCode(tx),\n    raw: tx\n  };\n};\nexport const NotificationProvider = ({\n  children\n}) => {\n  _s();\n  const [notifications, setNotifications] = useState([]);\n  const [readMap, setReadMap] = useState(() => loadReadState());\n  const [loading, setLoading] = useState(false);\n  const fetchNotifications = useCallback(async () => {\n    setLoading(true);\n    try {\n      var _res$data;\n      const res = await api.get(\"/api/transactions/history\");\n      const items = (((_res$data = res.data) === null || _res$data === void 0 ? void 0 : _res$data.transactions) || []).map(buildNotificationFromTransaction);\n      setNotifications(items.sort((a, b) => new Date(b.createdAt) - new Date(a.createdAt)));\n      return items;\n    } catch (e) {\n      return [];\n    } finally {\n      setLoading(false);\n    }\n  }, []);\n  useEffect(() => {\n    fetchNotifications();\n  }, [fetchNotifications]);\n  useEffect(() => {\n    saveReadState(readMap);\n  }, [readMap]);\n  const markAllAsRead = useCallback(() => {\n    const next = notifications.reduce((acc, item) => {\n      acc[item.id] = true;\n      return acc;\n    }, {});\n    setReadMap(next);\n  }, [notifications]);\n  const markAsRead = useCallback(id => {\n    setReadMap(curr => ({\n      ...curr,\n      [id]: true\n    }));\n  }, []);\n  const refresh = useCallback(async () => {\n    const items = await fetchNotifications();\n    setNotifications(items);\n    return items;\n  }, [fetchNotifications]);\n  const value = useMemo(() => {\n    const unreadCount = notifications.reduce((count, item) => {\n      return readMap[item.id] ? count : count + 1;\n    }, 0);\n    return {\n      notifications,\n      unreadCount,\n      loading,\n      refresh,\n      markAllAsRead,\n      markAsRead,\n      readMap\n    };\n  }, [notifications, readMap, refresh, markAllAsRead, markAsRead, loading]);\n  return /*#__PURE__*/_jsxDEV(NotificationContext.Provider, {\n    value: value,\n    children: children\n  }, void 0, false, {\n    fileName: _jsxFileName,\n    lineNumber: 134,\n    columnNumber: 5\n  }, this);\n};\n_s(NotificationProvider, \"yjoC9O/Hsf0JFAMX9C1eILcoCSI=\");\n_c = NotificationProvider;\nexport default NotificationContext;\nvar _c;\n$RefreshReg$(_c, \"NotificationProvider\");","map":{"version":3,"names":["React","createContext","useCallback","useEffect","useMemo","useState","api","getReferenceCode","jsxDEV","_jsxDEV","NotificationContext","notifications","unreadCount","refresh","Promise","resolve","markAllAsRead","markAsRead","STORAGE_KEY","loadReadState","raw","localStorage","getItem","JSON","parse","e","saveReadState","map","setItem","stringify","buildNotificationFromTransaction","tx","verb","type","actor","toUsername","description","title","direction","id","String","trim","amount","Number","status","createdAt","reference","NotificationProvider","children","_s","setNotifications","readMap","setReadMap","loading","setLoading","fetchNotifications","_res$data","res","get","items","data","transactions","sort","a","b","Date","next","reduce","acc","item","curr","value","count","Provider","fileName","_jsxFileName","lineNumber","columnNumber","_c","$RefreshReg$"],"sources":["D:/BMUDHT/frontend/src/context/NotificationContext.js"],"sourcesContent":["import React, {\r\n  createContext,\r\n  useCallback,\r\n  useEffect,\r\n  useMemo,\r\n  useState,\r\n} from \"react\";\r\nimport api from \"../services/api\";\r\nimport { getReferenceCode } from \"../utils/reference\";\r\n\r\nconst NotificationContext = createContext({\r\n  notifications: [],\r\n  unreadCount: 0,\r\n  refresh: () => Promise.resolve(),\r\n  markAllAsRead: () => {},\r\n  markAsRead: () => {},\r\n});\r\n\r\nconst STORAGE_KEY = \"notification.read\";\r\n\r\nconst loadReadState = () => {\r\n  try {\r\n    const raw = localStorage.getItem(STORAGE_KEY);\r\n    if (!raw) return {};\r\n    return JSON.parse(raw);\r\n  } catch (e) {\r\n    return {};\r\n  }\r\n};\r\n\r\nconst saveReadState = (map) => {\r\n  try {\r\n    localStorage.setItem(STORAGE_KEY, JSON.stringify(map));\r\n  } catch (e) {}\r\n};\r\n\r\nconst buildNotificationFromTransaction = (tx) => {\r\n  const verb =\r\n    tx.type === \"deposit\"\r\n      ? \"Nạp\"\r\n      : tx.type === \"transfer\"\r\n      ? \"Chuyển\"\r\n      : \"Giao dịch\";\r\n  const actor =\r\n    tx.type === \"deposit\"\r\n      ? \"vào tài khoản\"\r\n      : tx.type === \"transfer\"\r\n      ? `đến ${tx.toUsername}`\r\n      : tx.description || \"\";\r\n  const title =\r\n    tx.type === \"deposit\"\r\n      ? \"Nạp tiền thành công\"\r\n      : tx.type === \"transfer\"\r\n      ? \"Chuyển khoản thành công\"\r\n      : \"Giao dịch\";\r\n  const direction = tx.type === \"deposit\" ? 1 : -1;\r\n  return {\r\n    id: String(tx.id),\r\n    title,\r\n    description: tx.description || `${verb} ${actor}`.trim(),\r\n    amount: direction * Number(tx.amount || 0),\r\n    status: tx.status,\r\n    createdAt: tx.createdAt,\r\n    reference: getReferenceCode(tx),\r\n    raw: tx,\r\n  };\r\n};\r\n\r\nexport const NotificationProvider = ({ children }) => {\r\n  const [notifications, setNotifications] = useState([]);\r\n  const [readMap, setReadMap] = useState(() => loadReadState());\r\n  const [loading, setLoading] = useState(false);\r\n\r\n  const fetchNotifications = useCallback(async () => {\r\n    setLoading(true);\r\n    try {\r\n      const res = await api.get(\"/api/transactions/history\");\r\n      const items = (res.data?.transactions || []).map(\r\n        buildNotificationFromTransaction\r\n      );\r\n      setNotifications(\r\n        items.sort((a, b) => new Date(b.createdAt) - new Date(a.createdAt))\r\n      );\r\n      return items;\r\n    } catch (e) {\r\n      return [];\r\n    } finally {\r\n      setLoading(false);\r\n    }\r\n  }, []);\r\n\r\n  useEffect(() => {\r\n    fetchNotifications();\r\n  }, [fetchNotifications]);\r\n\r\n  useEffect(() => {\r\n    saveReadState(readMap);\r\n  }, [readMap]);\r\n\r\n  const markAllAsRead = useCallback(() => {\r\n    const next = notifications.reduce((acc, item) => {\r\n      acc[item.id] = true;\r\n      return acc;\r\n    }, {});\r\n    setReadMap(next);\r\n  }, [notifications]);\r\n\r\n  const markAsRead = useCallback((id) => {\r\n    setReadMap((curr) => ({ ...curr, [id]: true }));\r\n  }, []);\r\n\r\n  const refresh = useCallback(async () => {\r\n    const items = await fetchNotifications();\r\n    setNotifications(items);\r\n    return items;\r\n  }, [fetchNotifications]);\r\n\r\n  const value = useMemo(() => {\r\n    const unreadCount = notifications.reduce((count, item) => {\r\n      return readMap[item.id] ? count : count + 1;\r\n    }, 0);\r\n    return {\r\n      notifications,\r\n      unreadCount,\r\n      loading,\r\n      refresh,\r\n      markAllAsRead,\r\n      markAsRead,\r\n      readMap,\r\n    };\r\n  }, [notifications, readMap, refresh, markAllAsRead, markAsRead, loading]);\r\n\r\n  return (\r\n    <NotificationContext.Provider value={value}>\r\n      {children}\r\n    </NotificationContext.Provider>\r\n  );\r\n};\r\n\r\nexport default NotificationContext;\r\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}