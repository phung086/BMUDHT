{"ast":null,"code":"export const AUTH_EVENT = \"auth-token-change\";\nconst safeWindow = typeof window !== \"undefined\" ? window : null;\nconst TOKEN_KEY = \"token\";\nconst META_KEY = \"token-meta\";\nexport const IDLE_TIMEOUT_MS = 15 * 60 * 1000;\nexport const REFRESH_BUFFER_MS = 60 * 1000;\nconst readStorage = key => {\n  if (!safeWindow) return null;\n  try {\n    return safeWindow.localStorage.getItem(key);\n  } catch (error) {\n    return null;\n  }\n};\nconst writeStorage = (key, value) => {\n  if (!safeWindow) return;\n  try {\n    if (value === null || value === undefined) {\n      safeWindow.localStorage.removeItem(key);\n    } else {\n      safeWindow.localStorage.setItem(key, value);\n    }\n  } catch (error) {\n    /* no-op */\n  }\n};\nconst decodeBase64Url = value => {\n  if (!value) return \"\";\n  let normalized = value.replace(/-/g, \"+\").replace(/_/g, \"/\");\n  const padLength = (4 - normalized.length % 4) % 4;\n  if (padLength) {\n    normalized = normalized.padEnd(normalized.length + padLength, \"=\");\n  }\n  return safeWindow ? safeWindow.atob(normalized) : atob(normalized);\n};\nconst persistMeta = meta => {\n  writeStorage(META_KEY, JSON.stringify(meta));\n};\nexport const readToken = () => readStorage(TOKEN_KEY);\nexport const broadcastAuthChange = () => {\n  if (!safeWindow) return;\n  try {\n    safeWindow.dispatchEvent(new Event(AUTH_EVENT));\n  } catch (error) {\n    /* no-op */\n  }\n};\nexport const decodeTokenPayload = (token = readToken()) => {\n  if (!token) return null;\n  try {\n    const [, base64] = token.split(\".\");\n    if (!base64) return null;\n    const decoded = decodeBase64Url(base64);\n    return JSON.parse(decoded);\n  } catch (error) {\n    return null;\n  }\n};\nexport const getTokenMeta = () => {\n  const raw = readStorage(META_KEY);\n  if (!raw) return null;\n  try {\n    return JSON.parse(raw);\n  } catch (error) {\n    return null;\n  }\n};\nexport const persistToken = token => {\n  writeStorage(TOKEN_KEY, token);\n  if (!token) {\n    writeStorage(META_KEY, null);\n    return;\n  }\n  const payload = decodeTokenPayload(token);\n  const meta = {\n    exp: payload !== null && payload !== void 0 && payload.exp ? payload.exp * 1000 : null,\n    iat: payload !== null && payload !== void 0 && payload.iat ? payload.iat * 1000 : null,\n    lastActive: Date.now()\n  };\n  persistMeta(meta);\n};\nexport const clearToken = () => {\n  writeStorage(TOKEN_KEY, null);\n  writeStorage(META_KEY, null);\n};\nexport const markSessionActive = () => {\n  const token = readToken();\n  if (!token) return;\n  const meta = getTokenMeta() || {};\n  meta.lastActive = Date.now();\n  persistMeta(meta);\n};\nexport const getMillisUntilExpiry = () => {\n  const meta = getTokenMeta();\n  if (!(meta !== null && meta !== void 0 && meta.exp)) return Number.POSITIVE_INFINITY;\n  return meta.exp - Date.now();\n};\nexport const isTokenExpired = () => {\n  const remaining = getMillisUntilExpiry();\n  if (!Number.isFinite(remaining)) return false;\n  return remaining <= 0;\n};\nexport const shouldProactivelyRefresh = () => {\n  const remaining = getMillisUntilExpiry();\n  if (!Number.isFinite(remaining)) return false;\n  return remaining > 0 && remaining <= REFRESH_BUFFER_MS;\n};\nexport const hasIdleTimedOut = () => {\n  const meta = getTokenMeta();\n  if (!(meta !== null && meta !== void 0 && meta.lastActive)) return false;\n  return Date.now() - meta.lastActive >= IDLE_TIMEOUT_MS;\n};\nexport const getLastActive = () => {\n  var _meta$lastActive;\n  const meta = getTokenMeta();\n  return (_meta$lastActive = meta === null || meta === void 0 ? void 0 : meta.lastActive) !== null && _meta$lastActive !== void 0 ? _meta$lastActive : null;\n};","map":{"version":3,"names":["AUTH_EVENT","safeWindow","window","TOKEN_KEY","META_KEY","IDLE_TIMEOUT_MS","REFRESH_BUFFER_MS","readStorage","key","localStorage","getItem","error","writeStorage","value","undefined","removeItem","setItem","decodeBase64Url","normalized","replace","padLength","length","padEnd","atob","persistMeta","meta","JSON","stringify","readToken","broadcastAuthChange","dispatchEvent","Event","decodeTokenPayload","token","base64","split","decoded","parse","getTokenMeta","raw","persistToken","payload","exp","iat","lastActive","Date","now","clearToken","markSessionActive","getMillisUntilExpiry","Number","POSITIVE_INFINITY","isTokenExpired","remaining","isFinite","shouldProactivelyRefresh","hasIdleTimedOut","getLastActive","_meta$lastActive"],"sources":["D:/BMUDHT/frontend/src/utils/authSignal.js"],"sourcesContent":["export const AUTH_EVENT = \"auth-token-change\";\r\n\r\nconst safeWindow = typeof window !== \"undefined\" ? window : null;\r\n\r\nconst TOKEN_KEY = \"token\";\r\nconst META_KEY = \"token-meta\";\r\n\r\nexport const IDLE_TIMEOUT_MS = 15 * 60 * 1000;\r\nexport const REFRESH_BUFFER_MS = 60 * 1000;\r\n\r\nconst readStorage = (key) => {\r\n  if (!safeWindow) return null;\r\n  try {\r\n    return safeWindow.localStorage.getItem(key);\r\n  } catch (error) {\r\n    return null;\r\n  }\r\n};\r\n\r\nconst writeStorage = (key, value) => {\r\n  if (!safeWindow) return;\r\n  try {\r\n    if (value === null || value === undefined) {\r\n      safeWindow.localStorage.removeItem(key);\r\n    } else {\r\n      safeWindow.localStorage.setItem(key, value);\r\n    }\r\n  } catch (error) {\r\n    /* no-op */\r\n  }\r\n};\r\n\r\nconst decodeBase64Url = (value) => {\r\n  if (!value) return \"\";\r\n  let normalized = value.replace(/-/g, \"+\").replace(/_/g, \"/\");\r\n  const padLength = (4 - (normalized.length % 4)) % 4;\r\n  if (padLength) {\r\n    normalized = normalized.padEnd(normalized.length + padLength, \"=\");\r\n  }\r\n  return safeWindow ? safeWindow.atob(normalized) : atob(normalized);\r\n};\r\n\r\nconst persistMeta = (meta) => {\r\n  writeStorage(META_KEY, JSON.stringify(meta));\r\n};\r\n\r\nexport const readToken = () => readStorage(TOKEN_KEY);\r\n\r\nexport const broadcastAuthChange = () => {\r\n  if (!safeWindow) return;\r\n  try {\r\n    safeWindow.dispatchEvent(new Event(AUTH_EVENT));\r\n  } catch (error) {\r\n    /* no-op */\r\n  }\r\n};\r\n\r\nexport const decodeTokenPayload = (token = readToken()) => {\r\n  if (!token) return null;\r\n  try {\r\n    const [, base64] = token.split(\".\");\r\n    if (!base64) return null;\r\n    const decoded = decodeBase64Url(base64);\r\n    return JSON.parse(decoded);\r\n  } catch (error) {\r\n    return null;\r\n  }\r\n};\r\n\r\nexport const getTokenMeta = () => {\r\n  const raw = readStorage(META_KEY);\r\n  if (!raw) return null;\r\n  try {\r\n    return JSON.parse(raw);\r\n  } catch (error) {\r\n    return null;\r\n  }\r\n};\r\n\r\nexport const persistToken = (token) => {\r\n  writeStorage(TOKEN_KEY, token);\r\n  if (!token) {\r\n    writeStorage(META_KEY, null);\r\n    return;\r\n  }\r\n  const payload = decodeTokenPayload(token);\r\n  const meta = {\r\n    exp: payload?.exp ? payload.exp * 1000 : null,\r\n    iat: payload?.iat ? payload.iat * 1000 : null,\r\n    lastActive: Date.now(),\r\n  };\r\n  persistMeta(meta);\r\n};\r\n\r\nexport const clearToken = () => {\r\n  writeStorage(TOKEN_KEY, null);\r\n  writeStorage(META_KEY, null);\r\n};\r\n\r\nexport const markSessionActive = () => {\r\n  const token = readToken();\r\n  if (!token) return;\r\n  const meta = getTokenMeta() || {};\r\n  meta.lastActive = Date.now();\r\n  persistMeta(meta);\r\n};\r\n\r\nexport const getMillisUntilExpiry = () => {\r\n  const meta = getTokenMeta();\r\n  if (!meta?.exp) return Number.POSITIVE_INFINITY;\r\n  return meta.exp - Date.now();\r\n};\r\n\r\nexport const isTokenExpired = () => {\r\n  const remaining = getMillisUntilExpiry();\r\n  if (!Number.isFinite(remaining)) return false;\r\n  return remaining <= 0;\r\n};\r\n\r\nexport const shouldProactivelyRefresh = () => {\r\n  const remaining = getMillisUntilExpiry();\r\n  if (!Number.isFinite(remaining)) return false;\r\n  return remaining > 0 && remaining <= REFRESH_BUFFER_MS;\r\n};\r\n\r\nexport const hasIdleTimedOut = () => {\r\n  const meta = getTokenMeta();\r\n  if (!meta?.lastActive) return false;\r\n  return Date.now() - meta.lastActive >= IDLE_TIMEOUT_MS;\r\n};\r\n\r\nexport const getLastActive = () => {\r\n  const meta = getTokenMeta();\r\n  return meta?.lastActive ?? null;\r\n};\r\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}